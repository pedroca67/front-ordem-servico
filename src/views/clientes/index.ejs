<%- include("../partials/header") %>

<div class="level mt-5">
    <div class="level-left">
        <h1 class="title">Clientes Cadastrados</h1>
    </div>
    
    <div class="level-right">
        <div class="field is-grouped">
            <div class="field has-addons mr-3">
                <p class="control">
                    <span class="button is-static">
                        <i class="fas fa-search"></i>
                    </span>
                </p>
                <p class="control">
                    <input class="input" type="text" id="buscaCliente" 
                           onkeyup="filtrarClientes()" 
                           placeholder="Nome ou CPF...">
                </p>
            </div>

            <p class="control">
                <a href="/clientes/novo" class="button is-primary">
                    <span class="icon"><i class="fas fa-user-plus"></i></span>
                    <span>Novo Cliente</span>
                </a>
            </p>
        </div>
    </div>
</div>

<div class="box">
    <table class="table is-fullwidth is-striped is-hoverable" id="tabela-clientes">
        <thead>
            <tr>
                <th>Nome</th>
                <th>CPF</th>
                <th>Email</th>
                <th>Telefone</th>
                <th class="has-text-centered">Ações</th>
            </tr>
        </thead>
        <tbody>
            <% clientes.forEach(c => { %>
                <tr>
                    <td class="has-text-weight-bold"><%= c.nome %></td>
                    <td class="cpf-celula"><%= c.cpf %></td>
                    <td><%= c.email %></td>
                    <td><%= c.telefone %></td>
                    <td class="has-text-centered">
                        <a href="/clientes/<%= c.id %>/editar" class="button is-small is-info is-light">Editar</a>
                        <a href="/clientes/<%= c.id %>/excluir" class="button is-small is-danger is-light" onclick="return confirm('Excluir este cliente?')">Excluir</a>
                    </td>
                </tr>
            <% }) %>
        </tbody>
    </table>
</div>

<script>
function filtrarClientes() {
    const input = document.getElementById("buscaCliente");
    const filter = input.value.toUpperCase().replace(/[.\-/]/g, ""); // Limpa pontos e traços da busca
    const table = document.getElementById("tabela-clientes");
    const tr = table.getElementsByTagName("tr");

    for (let i = 1; i < tr.length; i++) {
        const tdNome = tr[i].getElementsByTagName("td")[0];
        const tdCPF = tr[i].getElementsByTagName("td")[1];

        if (tdNome && tdCPF) {
            const txtNome = (tdNome.textContent || tdNome.innerText).toUpperCase();
            const txtCPF = (tdCPF.textContent || tdCPF.innerText).replace(/[.\-/]/g, "");

            // Se bater no nome OU no CPF limpo
            if (txtNome.indexOf(filter) > -1 || txtCPF.indexOf(filter) > -1) {
                tr[i].style.display = "";
            } else {
                tr[i].style.display = "none";
            }
        }
    }
}
</script>

<%- include("../partials/footer") %>